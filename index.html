<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
 <title> ÙØ§ÛŒÙ„ Ù…Ø§Ø´ÛŒÙ†</title>
  <style>
    body {
        
      font-family: 'Tahoma', sans-serif;
      direction: rtl;
      padding: 20px;
      background: #f4f4f4;
      max-width: 600px;
      margin: auto;
    }
    
html {
  scroll-behavior: smooth;
}
    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
    }
    input, select, textarea {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      font-size: 16px;
      box-sizing: border-box;
border: 1px solid #ccc;
      border-radius: 8px;
      background: white;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
    }
    
input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #4CAF50;
      background-color: #f0fff0;
      box-shadow: 0 0 8px #4CAF50AA;
    }
    button {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 8px;
      width: 100%;
      transition: background 0.3s ease;
font-weight: bold
    }
    button:hover {
      background: #45a049;
    }
    #output {
      white-space: pre-line;
      background: #eee;
      padding: 15px;
      margin-top: 20px;
      border-radius: 8px;
      font-family: inherit;
      user-select: text;
box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .hint {
      font-size: 17px;
      color: #777;
      margin-top: 5px;
    }
    
    
.code-container {
    display: flex;
    align-items: stretch; 
    gap: 5px;
  }
  .code-container input {
    flex: 1;
    font-size: 16px;
    padding: 8px;
  }
  .code-container button {
    width: 40px;
    font-size: 20px;
    font-weight: bold;
    background: #4CAF50;
    color: white;
    border: none;
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
  }
.popup {
  position: fixed;
  top: 15vh;
  left: 50%;
  transform: translateX(-50%);
  width: 90%;
  max-width: 500px;
  padding: 13px;
  box-sizing: border-box;
  max-height: calc(var(--vh, 1vh) * 70);
  overflow-y: auto;
  background: white;
  z-index: 9999;
  border-radius: 10px;
  box-shadow: 0 0 10px #ccc;
  scrollbar-gutter: stable;

  opacity: 0;
  pointer-events: none;
  transform: translateX(-50%);
  transition: opacity 0.3s ease;
}

.popup.show {
  opacity: 1;
  pointer-events: auto;
}

.popup.hidden {
  opacity: 0;
  pointer-events: none;
}
.popup-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.4); /* Ù†ÛŒÙ…Ù‡â€ŒØªØ§Ø± */
  backdrop-filter: blur(4px);           /* Ø§ÙÚ©Øª Ù…Ø§Øª */
  z-index: 999;                         /* Ø²ÛŒØ± Ù¾Ø§Ù¾â€ŒØ¢Ù¾ */
}


.popup button {
  margin: 5px 0;
  padding: 6px 12px;
  font-size: 16px;
  margin-left: 10px;
  cursor: pointer;
border-radius: 6px;
      border: none;
      transition: background-color 0.3s ease;
      font-weight: bold;
}

.popup button.active {
  background-color: #388e3c;
  color: ;
  border: none;
  font-weight: bold;
  transform: scale(1.01); /* Ú©Ù…ÛŒ Ø¨Ø²Ø±Ú¯â€ŒØªØ± */
  box-shadow: 0 0 4px #4caf50aa;
}

ul {
  list-style: none;
  padding: 0;
  margin-top: 10px;
}

li {
  padding: 8px 12px;
  margin-bottom: 6px;
  background: #eee;
  border-radius: 6px;
  cursor: pointer;
  transition: background 0.2s;
}

li:hover {
  background: #d0f0d0;
}


.features-list {
  direction: rtl; /* Ø±Ø§Ø³Øªâ€ŒÚ†ÛŒÙ† Ø´Ø¯Ù† Ù…Ø­ØªÙˆØ§ */
  display: grid;
  grid-template-columns: repeat(2, max-content);
  gap: 5px 40px; /* ÙØ§ØµÙ„Ù‡ Ø±Ø¯ÛŒÙ Ùˆ Ø³ØªÙˆÙ† */
  max-height: 70vh;
  overflow-y: auto;
  padding: 10px;
}

.features-list label {
  display: flex;
  align-items: center; /* ØªØ±Ø§Ø² Ø¹Ù…ÙˆØ¯ÛŒ ÙˆØ³Ø· */
  gap: 6px; /* ÙØ§ØµÙ„Ù‡ Ø¨ÛŒÙ† Ú†Ú©â€ŒØ¨Ø§Ú©Ø³ Ùˆ Ù…ØªÙ† */
  cursor: pointer;
}

.features-list label input[type="checkbox"] {
  width: 16px;
  height: 16px;
  vertical-align: middle;
  margin: 0; /* Ø­Ø°Ù margin Ø§Ø¶Ø§ÙÛŒ */
}

#descPopup .features-list {
  overflow: visible !important;
  max-height: none !important;
}
.radio-grid {
  display: grid;
  grid-template-columns: repeat(2, auto); /* Ø¯Ùˆ Ø³ØªÙˆÙ† Ø¨Ø§ Ø¹Ø±Ø¶ Ø®ÙˆØ¯Ú©Ø§Ø± */
  gap: 4px 30px; /* ÙØ§ØµÙ„Ù‡ Ø¨ÛŒÙ† Ø±Ø¯ÛŒÙ Ùˆ Ø³ØªÙˆÙ† */
  
  margin-top: 8px;
  direction: rtl; 
background-color: #f0f0f0;

}

.radio-grid label {
  display: flex;
  align-items: center;
  gap: 6px;
white-space: nowrap; /* Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø´Ú©Ø³Øª Ù…ØªÙ† */
  
}

 .radio-grid input[type="radio"],
  .radio-grid input[type="checkbox"] {
    cursor: pointer;
    width: 14px;
    height: 14px;
    accent-color: #4CAF50;
  }
  
.search-input {
  width: 100%;
  padding: 6px 10px;
  margin-bottom: 8px;
  font-size: 16px;
  border: 1px solid #bbb;
  border-radius: 8px;
  box-sizing: border-box;
}
.popup-header {
  position: relative;
  text-align: center;
  padding: 10px 0;
}

.popup-header h4 {
  margin: 0;
  font-size: 18px;
}

.back-button {
  position: absolute;
  left: 10px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 20px;
  cursor: pointer;
  color: #007bff;
}
  
    input.error, select.error, textarea.error {
      border: 2px solid red;
    }
  </style>
</head>
<body>
<header style="
  position: sticky;
  top: 0;
  background: #ffffff;
  box-shadow: 0 2px 8px rgba(0,0,0,0.05);
  padding: 12px 24px;
  display: flex;
  justify-content: center;
  align-items: center;
border-radius: 0px;
  z-index: 1000;
  max-width: 600px;
  margin: auto;
  user-select: none;
">
  <a href="https://t.me/Bongahi_bot" target="_blank" rel="noopener"
     style="color: #2563eb; text-decoration: none; display: flex; align-items: center; gap: 6px; font-size: 24px; font-weight: bold;">
    Bongahi_bot
    <img src="https://upload.wikimedia.org/wikipedia/commons/8/82/Telegram_logo.svg" alt="Telegram"
         style="width: 24px; height: 24px;">
  </a>
</header>

<h2 style="display: flex; flex-wrap: wrap; align-items: center; gap: 6px;">
  ÙØ§ÛŒÙ„ Ù…Ø§Ø´ÛŒÙ†
   <span id="today-date" style="font-size: 0.6em; color: #888; font-weight: normal; white-space: nowrap;">
  </span>
</h2>
 
<label for="code">Ú©Ø¯ ØªØ®ÙÛŒÙ:</label>
<div class="code-container">
  <input type="text" id="code" placeholder="" />
  <button type="button" onclick="incrementCode()">â•</button>
  </div>
  
 <label>Ù†Ø§Ø­ÛŒÙ‡:</label>
  <select id="area"></select>
  
 <label for="brandInput">Ù†Ø§Ù… Ù…Ø§Ø´ÛŒÙ†:</label>
 <!-- Ø¨Ø§Ú©Ø³ Ø§ØµÙ„ÛŒ ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ -->
<input type="text" id="brandInput" placeholder="Ø¨Ø±Ù†Ø¯ Ùˆ Ù…Ø¯Ù„ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯..." readonly onclick="openBrandPopup()" />

<!-- Ù¾Ø§Ù¾â€ŒØ¢Ù¾ Ø§Ù†ØªØ®Ø§Ø¨ Ø¨Ø±Ù†Ø¯ -->
<div id="popupBrand" class="popup" style="display:none;">
  <div>
    <button onclick="showBrandList('irani')">ğŸ‡®ğŸ‡· Ø¨Ø±Ù†Ø¯Ù‡Ø§ÛŒ Ø§ÛŒØ±Ø§Ù†ÛŒ</button>
    <button onclick="showBrandList('khareji')">ğŸŒ Ø¨Ø±Ù†Ø¯Ù‡Ø§ÛŒ Ø®Ø§Ø±Ø¬ÛŒ</button>
  
  <button onclick="showBrandList('heavy')">ğŸš Ø³Ù†Ú¯ÛŒÙ† ğŸš›</button>
  
  </div>
<input type="text" id="searchBrandInput" class="search-input" placeholder="Ø¬Ø³ØªØ¬ÙˆÛŒ Ø¨Ø±Ù†Ø¯ØŒ Ù…Ø¯Ù„ Ùˆ ...."/>
  
  <ul id="brandList"></ul>
</div>

<!-- Ù¾Ø§Ù¾â€ŒØ¢Ù¾ Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø¯Ù„ -->
<div id="popupModel" class="popup" style="display:none;">
  <div class="popup-header">
    <span class="back-button" onclick="backToBrands()">â†</span>
    <h4>Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯</h4>
  </div>

  <input type="text" id="searchModelInput" class="search-input" placeholder="Ø¬Ø³ØªØ¬ÙˆÛŒ Ù…Ø¯Ù„..." />
  <ul id="modelList"></ul>
</div>

<!-- Ù¾Ø§Ù¾â€ŒØ¢Ù¾ Ø§Ù†ØªØ®Ø§Ø¨ ØªÛŒÙ¾ -->
<div id="popupTip" class="popup" style="display:none;">
  <div class="popup-header">
    <span class="back-button" onclick="backToModels()">â†</span>
    <h4>Ø§Ù†ØªØ®Ø§Ø¨ ØªÛŒÙ¾</h4>
  </div>
  <ul id="tipList"></ul>
</div>
  <label>Ù‚ÛŒÙ…Øª (ØªÙˆÙ…Ø§Ù†):</label>
  <input
    type="number"
    id="price"
    oninput="updatePriceLabel()"
  />
  <div  class="hint" id="priceHint"></div>
  
  <label>Ø³Ø§Ù„ ØªÙˆÙ„ÛŒØ¯:</label>
  <select id="year"></select>

  <label>Ú©Ø§Ø±Ú©Ø±Ø¯ (Ú©ÛŒÙ„ÙˆÙ…ØªØ±):</label>
  <input type="number" id="km" oninput="updateKmLabel()" />
  <div class="hint" id="kmHint"></div>
<label> Ú¯ÛŒØ±Ø¨Ú©Ø³:</label>
<select id="gearbox">
  <option value="Ø¯Ù†Ø¯Ù‡â€ŒØ§ÛŒ">Ø¯Ù†Ø¯Ù‡â€ŒØ§ÛŒ</option>
  <option value="Ø§ØªÙˆÙ…Ø§ØªÛŒÚ©">Ø§ØªÙˆÙ…Ø§ØªÛŒÚ©</option>
</select>

  <label>Ø±Ù†Ú¯:</label>
  <select id="color">
    <option value="Ø³ÙÛŒØ¯">Ø³ÙÛŒØ¯</option>
    <option value="Ù…Ø´Ú©ÛŒ">Ù…Ø´Ú©ÛŒ</option>
  <option value="Ù…Ø´Ú©ÛŒ Ù…ØªØ§Ù„ÛŒÚ©">Ù…Ø´Ú©ÛŒ Ù…ØªØ§Ù„ÛŒÚ©</option>
  <option value="Ø¯Ù„ÙÛŒÙ†ÛŒ">Ø¯Ù„ÙÛŒÙ†ÛŒ</option>
    <option value="Ù†Ù‚Ø±Ù‡â€ŒØ§ÛŒ">Ù†Ù‚Ø±Ù‡â€ŒØ§ÛŒ</option>
    <option value="Ø¢Ø¨ÛŒ">Ø¢Ø¨ÛŒ</option>
 <option value="Ø¢Ø¨ÛŒ Ø±ÙˆÛŒØ§Ù„">Ø¢Ø¨ÛŒ Ø±ÙˆÛŒØ§Ù„</option>
    <option value="Ù‚Ø±Ù…Ø²">Ù‚Ø±Ù…Ø²</option>
    <option value="Ø³Ø¨Ø²">Ø³Ø¨Ø²</option>
    <option value="Ø®Ø§Ú©Ø³ØªØ±ÛŒ">Ø®Ø§Ú©Ø³ØªØ±ÛŒ</option>
    <option value="Ø²Ø±Ø¯">Ø²Ø±Ø¯</option>
  </select>

  <label>ÙˆØ¶Ø¹ÛŒØª Ù…ÙˆØªÙˆØ±:</label>
  <select id="motor">
    <option value="Ø³Ø§Ù„Ù…">Ø³Ø§Ù„Ù…</option>
    <option value="Ù†ÛŒØ§Ø² Ø¨Ù‡ ØªØ¹Ù…ÛŒØ±">Ù†ÛŒØ§Ø² Ø¨Ù‡ ØªØ¹Ù…ÛŒØ±</option>
  <option value="ØªØ§Ø²Ù‡ ØªØ¹Ù…ÛŒØ±">ØªØ§Ø²Ù‡ ØªØ¹Ù…ÛŒØ±</option>
    <option value="ØªØ¹ÙˆÛŒØ¶ Ø´Ø¯Ù‡">ØªØ¹ÙˆÛŒØ¶ Ø´Ø¯Ù‡</option>
  </select>

  <label>ÙˆØ¶Ø¹ÛŒØª Ø¨Ø¯Ù†Ù‡:</label>
  <select id="body">
    <option value="Ø³Ø§Ù„Ù… Ùˆ Ø¨ÛŒâ€ŒØ®Ø· Ùˆ Ø®Ø´">Ø³Ø§Ù„Ù… Ùˆ Ø¨ÛŒâ€ŒØ®Ø· Ùˆ Ø®Ø´</option>
    <option value="Ø®Ø· Ùˆ Ø®Ø´ Ø¬Ø²Ø¦ÛŒ">Ø®Ø· Ùˆ Ø®Ø´ Ø¬Ø²Ø¦ÛŒ</option>
   <option value="  Ø±Ù†Ú¯â€ŒØ´Ø¯Ú¯ÛŒ Ø¯Ø§Ø±Ø¯">Ø±Ù†Ú¯â€ŒØ´Ø¯Ú¯ÛŒ Ø¯Ø§Ø±Ø¯</option>
    <option value="Ø¯ÙˆØ±Ø±Ù†Ú¯">Ø¯ÙˆØ±Ø±Ù†Ú¯</option>
  </select>

  <label>Ù…Ù‡Ù„Øª Ø¨ÛŒÙ…Ù‡ Ø«Ø§Ù„Ø« (Ù…Ø§Ù‡):</label>
  <select id="bimeh"></select>

 <label for="features">Ø§Ù…Ú©Ø§Ù†Ø§Øª:</label>
<textarea type="text" id="features" placeholder="Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯" readonly onclick="openFeaturesPopup()"></textarea>
<div id="featuresPopup" class="popup" style="display:none;">
  
  <div class="features-list">
 <label>
      <input type="checkbox" value="----" />
      ----
    </label>
    <label>
      <input type="checkbox" value="Ø³Ø§Ù†Ø±ÙˆÙ" />
      Ø³Ø§Ù†Ø±ÙˆÙ
    </label>
    <label>
      <input type="checkbox" value="ØªÙ‡ÙˆÛŒÙ‡ Ø§ØªÙˆÙ…Ø§ØªÛŒÚ©" />
      ØªÙ‡ÙˆÛŒÙ‡ Ø§ØªÙˆÙ…Ø§ØªÛŒÚ©
    </label>
    <label>
      <input type="checkbox" value="ØµÙ†Ø¯Ù„ÛŒ Ø¨Ø±Ù‚ÛŒ" />
      ØµÙ†Ø¯Ù„ÛŒ Ø¨Ø±Ù‚ÛŒ
    </label>
    <label>
      <input type="checkbox" value="Ø³Ù†Ø³ÙˆØ± Ø¯Ù†Ø¯Ù‡ Ø¹Ù‚Ø¨" />
      Ø³Ù†Ø³ÙˆØ± Ø¯Ù†Ø¯Ù‡ Ø¹Ù‚Ø¨
    </label>
    
 <label>
      <input type="checkbox" value="Ø¯Ø²Ø¯Ú¯ÛŒØ±" />
      Ø¯Ø²Ø¯Ú¯ÛŒØ±
    </label>
    <label>
      <input type="checkbox" value="Ú©Ø±ÙˆØ² Ú©Ù†ØªØ±Ù„" />
      Ú©Ø±ÙˆØ² Ú©Ù†ØªØ±Ù„
    </label>
    <label>
      <input type="checkbox" value="ÙØ±Ù…Ø§Ù† Ø¨Ø±Ù‚ÛŒ" />
      ÙØ±Ù…Ø§Ù† Ø¨Ø±Ù‚ÛŒ
    </label>
    <label>
      <input type="checkbox" value="Ù…Ø§Ù†ÛŒØªÙˆØ±" />
      Ù…Ø§Ù†ÛŒØªÙˆØ±
    </label>
    
  <label>
   <input type="checkbox" value="Ø³Ù‚Ù Ù¾Ø§Ù†ÙˆØ±Ø§Ù…Ø§"/>
       Ø³Ù‚Ù Ù¾Ø§Ù†ÙˆØ±Ø§Ù…Ø§
    </label>

    <label>
      <input type="checkbox" value="Ø§Ø³ØªØ§Ø±Øª Ø¯Ú©Ù…Ù‡â€ŒØ§ÛŒ" />
      Ø§Ø³ØªØ§Ø±Øª Ø¯Ú©Ù…Ù‡â€ŒØ§ÛŒ
    </label>
    <label>
      <input type="checkbox" value="Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø¹Ù‚Ø¨" />
      Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø¹Ù‚Ø¨
    </label>
  <label>
      <input type="checkbox" value="Ø¯ÙˆØ±Ø¨ÛŒÙ† 360" />
      Ø¯ÙˆØ±Ø¨ÛŒÙ† 360  </label>
<label>
  <input type="checkbox" value="Ø´ÛŒØ´Ù‡ Ø¯ÙˆØ¯ÛŒ" />
  Ø´ÛŒØ´Ù‡ Ø¯ÙˆØ¯ÛŒ
</label>

<label>
  <input type="checkbox" value="Ø¯ÛŒâ€ŒÙ„Ø§ÛŒØª" />
  Ø¯ÛŒâ€ŒÙ„Ø§ÛŒØª
</label>
    
  </div>
  <button onclick="confirmFeatures()">ØªØ£ÛŒÛŒØ¯</button>
</div>


<label for="desc">Ø³Ø§ÛŒØ± ØªÙˆØ¶ÛŒØ­Ø§Øª:</label>
<textarea type="text" id="desc" placeholder="Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯" readonly onclick="openDescPopup()"></textarea>

<div id="descPopup" class="popup" style="display:none;">
  <div class="features-list" style="grid-template-columns: 1fr;">
  
  <label>
      <input type="checkbox" value="----" /> ----
    </label>
    <label>
      <input type="checkbox" value="Ù‚ÛŒÙ…Øª Ù…Ù‚Ø·ÙˆØ¹" /> Ù‚ÛŒÙ…Øª Ù…Ù‚Ø·ÙˆØ¹
    </label>
    
<label>
      <input type="checkbox" value="ÙØ±ÙˆØ´ ÙÙ‚Ø· Ù†Ù‚Ø¯ÛŒ " /> ÙØ±ÙˆØ´ ÙÙ‚Ø· Ù†Ù‚Ø¯ÛŒ  </label>
      
    <label><input type="checkbox" value="Ù…Ø§ÛŒÙ„ Ø¨Ù‡ Ù…Ø¹Ø§ÙˆØ¶Ù‡ "/> Ù…Ø§ÛŒÙ„ Ø¨Ù‡ Ù…Ø¹Ø§ÙˆØ¶Ù‡ </label>
    
<label>
      <input type="checkbox" value="ÙØ±ÙˆØ´ Ø¨Ù‡ ØµÙˆØ±Øª Ø­ÙˆØ§Ù„Ù‡ "/> ÙØ±ÙˆØ´ Ø¨Ù‡ ØµÙˆØ±Øª Ø­ÙˆØ§Ù„Ù‡ </label>
      

 <label>
      <input type="checkbox" value="Ú¯Ø§Ø±Ø§Ù†ØªÛŒ ÙØ¹Ø§Ù„" /> Ú¯Ø§Ø±Ø§Ù†ØªÛŒ ÙØ¹Ø§Ù„
    </label>
   
 <label>
      <input type="checkbox" value="Ù…ÙˆØªÙˆØ± ØªØ¹ÙˆÛŒØ¶ Ù‚Ø§Ù†ÙˆÙ†ÛŒ " /> Ù…ÙˆØªÙˆØ± ØªØ¹ÙˆÛŒØ¶ Ù‚Ø§Ù†ÙˆÙ†ÛŒ </label>
    
<label>
  <input type="checkbox" value="Ø¨ÛŒÙ…Ù‡ Ø¨Ø¯Ù†Ù‡ Ø¯Ø§Ø±Ø¯"  />
  Ø¨ÛŒÙ…Ù‡ Ø¨Ø¯Ù†Ù‡ Ø¯Ø§Ø±Ø¯
</label>
    <label><input type="checkbox" value="ØªÚ© Ø¨Ø±Ú¯ Ø³Ù†Ø¯"/> ØªÚ© Ø¨Ø±Ú¯ Ø³Ù†Ø¯ </label>
    

<label>
  <input type="checkbox" id="consumableToggle" value="Ù…ØµØ±ÙÛŒâ€ŒÙ‡Ø§ÛŒ ØªØ§Ø²Ù‡ ØªØ¹ÙˆÛŒØ¶ Ø´Ø¯Ù‡" onchange="toggleConsumables()" />
  Ù…ØµØ±ÙÛŒâ€ŒÙ‡Ø§ÛŒ ØªØ§Ø²Ù‡ ØªØ¹ÙˆÛŒØ¶ Ø´Ø¯Ù‡
</label>

<!-- Ø¨Ø®Ø´ Ø±Ø§Ø¯ÛŒÙˆÛŒÛŒ Ú©Ù‡ Ù…Ø®ÙÛŒ Ø§Ø³Øª -->
<div id="consumablesRadios" class="radio-grid" style="display: none;">
    
<label><input type="checkbox" name="consumableItem" value="Ø±ÙˆØºÙ† Ù…ÙˆØªÙˆØ±" /> Ø±ÙˆØºÙ† Ù…ÙˆØªÙˆØ±</label>

<label><input type="checkbox" name="consumableItem" value="Ø±ÙˆØºÙ† Ú¯ÛŒØ±Ø¨Ú©Ø³" /> Ø±ÙˆØºÙ† Ú¯ÛŒØ±Ø¨Ú©Ø³</label>

  <label><input type="checkbox" name="consumableItem" value="Ø¨Ø§ØªØ±ÛŒ" /> Ø¨Ø§ØªØ±ÛŒ</label>
  <label><input type="checkbox" name="consumableItem" value="Ø´Ù…Ø¹" /> Ø´Ù…Ø¹</label>
  <label><input type="checkbox" name="consumableItem" value="ÙˆØ§ÛŒØ± Ø´Ù…Ø¹" /> ÙˆØ§ÛŒØ± Ø´Ù…Ø¹</label>
  <label><input type="checkbox" name="consumableItem" value="ØªØ³Ù…Ù‡ ØªØ§ÛŒÙ…" /> ØªØ³Ù…Ù‡ ØªØ§ÛŒÙ…</label>
<label><input type="checkbox" name="consumableItem" value="ØªØ³Ù…Ù‡ Ø¯ÛŒÙ†Ø§Ù…" /> ØªØ³Ù…Ù‡ Ø¯ÛŒÙ†Ø§Ù…</label>
<label><input type="checkbox" name="consumableItem" value="Ù„Ù†Øª" /> Ù„Ù†Øª</label>
<label><input type="checkbox" name="consumableItem" value="Ø¯ÛŒØ³Ú© Ùˆ ØµÙØ­Ù‡ Ú©Ù„Ø§Ú† "> Ø¯ÛŒØ³Ú© Ùˆ ØµÙØ­Ù‡ Ú©Ù„Ø§Ú†</label>
  <label><input type="checkbox" name="consumableItem" value="Ø³ÛŒÙ… Ú©Ù„Ø§Ú†" /> Ø³ÛŒÙ… Ú©Ù„Ø§Ú†</label>
  <label><input type="checkbox" name="consumableItem" value="Ø±Ø§Ø¯ÛŒØ§ØªÙˆØ±" /> Ø±Ø§Ø¯ÛŒØ§ØªÙˆØ±</label>
</div>
 
    
  <label>
  <input type="checkbox" id="dualToggle" value="Ø¯ÙˆÚ¯Ø§Ù†Ù‡ " onchange="toggleDualType()" />
  Ø¯ÙˆÚ¯Ø§Ù†Ù‡ 
</label>
<div id="dualTypeRadios" class="radio-grid" style="display: none;">
  <label><input type="radio" name="dualType" value="Ø¯Ø³ØªÛŒ"/>Ø¯Ø³ØªÛŒ</label>
  <label><input type="radio" name="dualType" value="ÙØ§Ø¨Ø±ÛŒÚ©"/>ÙØ§Ø¨Ø±ÛŒÚ©</label>
</div>
<label>
  <input type="checkbox" id="taxiToggle" value="ØªØ§Ú©Ø³ÛŒ " onchange="toggleTaxiType()" />
  ØªØ§Ú©Ø³ÛŒ 
</label>
<div id="taxiTypeRadios" class="radio-grid" style="display: none;">
  <label><input type="radio" name="taxiType" value="Ø¯Ø±ÙˆÙ†â€ŒØ´Ù‡Ø±ÛŒ" />Ø¯Ø±ÙˆÙ†â€ŒØ´Ù‡Ø±ÛŒ</label>
  <label><input type="radio" name="taxiType" value="Ø¨Ø±ÙˆÙ†â€ŒØ´Ù‡Ø±ÛŒ" />Ø¨Ø±ÙˆÙ†â€ŒØ´Ù‡Ø±ÛŒ</label>
</div>

<label>
  <input type="checkbox" id="rangToggle" value="ÙˆØ¶Ø¹ÛŒØª Ø±Ù†Ú¯â€ŒØ´Ø¯Ú¯ÛŒ" onchange="toggleRangType()" />
  ÙˆØ¶Ø¹ÛŒØª Ø±Ù†Ú¯â€ŒØ´Ø¯Ú¯ÛŒ
</label>

<div id="rangTypeRadios" class="radio-grid" style="display: none;">
  

<label><input type="checkbox" name="rang" value="Ú¯Ù„Ú¯ÛŒØ± Ø¬Ù„Ùˆ Ú†Ù¾" /> Ú¯Ù„Ú¯ÛŒØ± Ø¬Ù„Ùˆ Ú†Ù¾</label>
<label><input type="checkbox" name="rang" value="Ú¯Ù„Ú¯ÛŒØ± Ø¬Ù„Ùˆ Ø±Ø§Ø³Øª" /> Ú¯Ù„Ú¯ÛŒØ± Ø¬Ù„Ùˆ Ø±Ø§Ø³Øª</label>
<label><input type="checkbox" name="rang" value="Ú¯Ù„Ú¯ÛŒØ± Ø¹Ù‚Ø¨ Ú†Ù¾" /> Ú¯Ù„Ú¯ÛŒØ± Ø¹Ù‚Ø¨ Ú†Ù¾</label>
<label><input type="checkbox" name="rang" value="Ú¯Ù„Ú¯ÛŒØ± Ø¹Ù‚Ø¨ Ø±Ø§Ø³Øª" /> Ú¯Ù„Ú¯ÛŒØ± Ø¹Ù‚Ø¨ Ø±Ø§Ø³Øª</label>
 <label><input type="checkbox" name="rang" value="Ø¯Ø±Ø¨ Ø¬Ù„Ùˆ Ú†Ù¾"> Ø¯Ø±Ø¨ Ø¬Ù„Ùˆ Ú†Ù¾</label>
  <label><input type="checkbox" name="rang" value="Ø¯Ø±Ø¨ Ø¬Ù„Ùˆ Ø±Ø§Ø³Øª"> Ø¯Ø±Ø¨ Ø¬Ù„Ùˆ Ø±Ø§Ø³Øª</label>
  <label><input type="checkbox" name="rang" value="Ø¯Ø±Ø¨ Ø¹Ù‚Ø¨ Ú†Ù¾"> Ø¯Ø±Ø¨ Ø¹Ù‚Ø¨ Ú†Ù¾</label>
  <label><input type="checkbox" name="rang" value="Ø¯Ø±Ø¨ Ø¹Ù‚Ø¨ Ø±Ø§Ø³Øª"> Ø¯Ø±Ø¨ Ø¹Ù‚Ø¨ Ø±Ø§Ø³Øª</label>
<label><input type="checkbox" name="rang" value="Ú©Ø§Ù¾ÙˆØª" /> Ú©Ø§Ù¾ÙˆØª</label>
<label><input type="checkbox" name="rang" value="Ø³Ù‚Ù" /> Ø³Ù‚Ù</label>
<label><input type="checkbox" name="rang" value="ØµÙ†Ø¯ÙˆÙ‚ Ø¹Ù‚Ø¨" /> ØµÙ†Ø¯ÙˆÙ‚ Ø¹Ù‚Ø¨</label>
</div>

<label>
  <input type="checkbox" id="shassiToggle" value="ÙˆØ¶Ø¹ÛŒØª Ø´Ø§Ø³ÛŒ" onchange="toggleShassiType()" />
  ÙˆØ¶Ø¹ÛŒØª Ø´Ø§Ø³ÛŒ
</label>

<div id="shassiTypeRadios" class="radio-grid" style="display: none;">
<label><input type="checkbox" name="shassi" value="Ø³Ø§Ù„Ù…" /> Ø³Ø§Ù„Ù…</label>
<label><input type="checkbox" name="shassi" value="Ø¶Ø±Ø¨Ù‡ Ø¬Ø²Ø¦ÛŒ Ø¬Ù„Ùˆ" /> Ø¶Ø±Ø¨Ù‡ Ø¬Ø²Ø¦ÛŒ Ø¬Ù„Ùˆ</label>
<label><input type="checkbox" name="shassi" value="Ø¶Ø±Ø¨Ù‡ Ø¬Ø²Ø¦ÛŒ Ø¹Ù‚Ø¨" /> Ø¶Ø±Ø¨Ù‡ Ø¬Ø²Ø¦ÛŒ Ø¹Ù‚Ø¨</label>
<label><input type="checkbox" name="shassi" value="Ø¬ÙˆØ´Ú©Ø§Ø±ÛŒ Ø¬Ù„Ùˆ" /> Ø¬ÙˆØ´Ú©Ø§Ø±ÛŒ Ø¬Ù„Ùˆ</label>
<label><input type="checkbox" name="shassi" value="Ø¬ÙˆØ´Ú©Ø§Ø±ÛŒ Ø¹Ù‚Ø¨" /> Ø¬ÙˆØ´Ú©Ø§Ø±ÛŒ Ø¹Ù‚Ø¨</label>
<label><input type="checkbox" name="shassi" value="Ø´Ø§Ø³ÛŒâ€ŒÚ©Ø´ÛŒ Ø´Ø¯Ù‡" /> Ø´Ø§Ø³ÛŒâ€ŒÚ©Ø´ÛŒ Ø´Ø¯Ù‡</label>
</div>

 </div>
  <button onclick="confirmDesc()">ØªØ£ÛŒÛŒØ¯</button>
</div>

  <button onclick="viewFile()">ğŸ“„ Ù…Ø´Ø§Ù‡Ø¯Ù‡ ÙØ§ÛŒÙ„</button>
  <div id="output" style="display: none;"></div>
  <button id="sendBtn" onclick="sendToTelegram()" style="display: none;">ğŸ“‹ Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ ØªÙ„Ú¯Ø±Ø§Ù…</button>
  
  <button id="resetBtn" onclick="resetForm()" style="display: none; background: #f44336;">ğŸ—‘ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù†</button>

<button onclick="showHistory()" style="background: #2196F3; margin-top: 15px;">ğŸ“‘ ØªØ§Ø±ÛŒØ®Ú†Ù‡ ÙØ§ÛŒÙ„ Ù‡Ø§</button>


<!-- Ù¾Ø§Ù¾â€ŒØ¢Ù¾ ØªØ§Ø±ÛŒØ®Ú†Ù‡ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ -->
<div id="historyPopup" style="
  display: none;
  position: fixed;
  top: 5%;
  left: 50%;
  transform: translateX(-50%);
  width: 80%;
  height: 80%;
  background: white;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 0;
  z-index: 10000;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  flex-direction: column;
">
  <div style="padding: 15px; overflow-y: auto; flex-grow: 1;">
    
    <ul id="historyList" style="list-style: none; padding: 0;"></ul>
  </div>
  <div style="padding: 10px; border-top: 1px solid #ccc; text-align: center;">
    <button onclick="document.getElementById('historyPopup').style.display='none'" style="
      padding: 8px 16px;
      background: #888;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 17px;
      cursor: pointer;
    ">âŒ Ø¨Ø³ØªÙ†</button>
  </div>
</div>

<!-- Ù¾Ø§Ù¾â€ŒØ¢Ù¾ Ù†Ù…Ø§ÛŒØ´ Ø¬Ø²Ø¦ÛŒØ§Øª ÙØ§ÛŒÙ„ -->
<div id="detailsPopup" style="display:none; position: fixed; top: 10%; left: 50%; transform: translateX(-50%);
  background: white; padding: 20px; width: 80%; max-height: 70%; overflow-y: auto;
  border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); z-index: 10001;">
  <pre id="detailsText" style="white-space: pre-wrap; font-family: inherit;"></pre>
 <div style="display: flex; justify-content: center; gap: 12px; margin-top: 15px;">
     
     <!--
  <button onclick="applyDetailsEdit()" style="background: #4CAF50; color: white; padding: 8px 16px; border: none; border-radius: 6px; font-size: 15px;">âœ ÙˆÛŒØ±Ø§ÛŒØ´</button>
  
  -->
  
  <button onclick="document.getElementById('detailsPopup').style.display='none'" style="background: #888; padding: 8px 16px; border: none; border-radius: 6px; font-size: 17px;">  âŒ Ø¨Ø³ØªÙ†  </button>
</div>
</div>

<!-- Ù„Ø§ÛŒÙ‡ Ù†ÛŒÙ…Ù‡â€ŒØ´ÙØ§Ù Ù¾Ø´Øª Ù¾Ø§Ù¾â€ŒØ¢Ù¾ -->
<div id="popupOverlay" class="popup-overlay" style="display: none;"></div>
  
  <script>
  
const today = new Date();
  const days = ["ÛŒÚ©Ø´Ù†Ø¨Ù‡","Ø¯ÙˆØ´Ù†Ø¨Ù‡","Ø³Ù‡â€ŒØ´Ù†Ø¨Ù‡","Ú†Ù‡Ø§Ø±Ø´Ù†Ø¨Ù‡","Ù¾Ù†Ø¬Ø´Ù†Ø¨Ù‡","Ø¬Ù…Ø¹Ù‡","Ø´Ù†Ø¨Ù‡"];
  const persianDate = today.toLocaleDateString('fa-IR');
  document.getElementById("today-date").textContent = `(Ø§Ù…Ø±ÙˆØ²: ${days[today.getDay()]} ${persianDate})`;
  
  // Ø³Øª Ú©Ø±Ø¯Ù† vh ÙˆØ§Ù‚Ø¹ÛŒ Ø¨Ø±Ø§ÛŒ Ø­Ù„ Ù…Ø´Ú©Ù„ Ù…ÙˆØ¨Ø§ÛŒÙ„
  function setRealVh() {
    document.documentElement.style.setProperty('--vh', window.innerHeight * 0.01 + 'px');
  }
  window.addEventListener('resize', setRealVh);
  window.addEventListener('load', setRealVh);

const areaSelect = document.getElementById('area');
    for (let i = 1; i <= 12; i++) {
      const option = document.createElement('option');
      option.value = i;
      option.textContent = i.toLocaleString('fa-IR') ;
      areaSelect.appendChild(option);
    }


    const yearSelect = document.getElementById('year');
    for (let i = 1404; i >= 1350; i--) {
      const option = document.createElement('option');
      option.value = i;
      option.textContent = i.toString().replace(/\d/g, d => 'Û°Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹'[d]);
      yearSelect.appendChild(option);
    }

    const bimehSelect = document.getElementById('bimeh');
    for (let i = 1; i <= 12; i++) {
      const option = document.createElement('option');
      option.value = i;
      option.textContent = i.toLocaleString('fa-IR') ;
      bimehSelect.appendChild(option);
    }

    function updatePriceLabel() {
      const price = document.getElementById('price').value;
      const hint = document.getElementById('priceHint');
      hint.textContent = price ? `${parseInt(price).toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†` : '';
    }

    function updateKmLabel() {
      const km = document.getElementById('km').value;
      const hint = document.getElementById('kmHint');
      hint.textContent = km ? `${parseInt(km).toLocaleString('fa-IR')} Ú©ÛŒÙ„ÙˆÙ…ØªØ±` : '';
    }
    
function enableScrollOnFocus(inputId, hintId) {
  const input = document.getElementById(inputId);
  const hint = document.getElementById(hintId);

  input.addEventListener('focus', () => {
    setTimeout(() => {
      hint.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }, 300);
  });
}

// Ø§Ø¹Ù…Ø§Ù„ Ø¨Ø±Ø§ÛŒ ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø±
enableScrollOnFocus('price', 'priceHint');
enableScrollOnFocus('km', 'kmHint');

    function generateHashtags(car, year, areaText) {
  function normalize(str) {
    return str.replace(/[^\u0600-\u06FFa-zA-Z0-9]/g, '').replace(/\s+/g, '').toLowerCase();
  }

  const parts = car.trim().split(/\s*-\s*/); // Ø´Ú©Ø³ØªÙ† Ø¨Ù‡ Ø¨Ø®Ø´â€ŒÙ‡Ø§ Ø¨Ø§ "-"
  const brandTrimmed = parts[0]?.trim() || '';
  const modelTrimmed = parts[1]?.trim() || '';
  const tipTrimmed = parts[2]?.trim() || '';

  const cleanBrand = normalize(brandTrimmed);
  const isForeign = brands['khareji'].some(b => normalize(b) === cleanBrand);

  let name = '';

  if (modelTrimmed && !normalize(modelTrimmed).startsWith(cleanBrand)) {
    name = `${brandTrimmed}_${modelTrimmed}`;
  } else if (modelTrimmed) {
    name = modelTrimmed;
  } else {
    name = brandTrimmed;
  }

  if (tipTrimmed) {
    name += `_${tipTrimmed}`;
  }

  // ØªØ¹ÛŒÛŒÙ† Ø¨Ø®Ø´ Ø³Ø§Ù„
  let yearTag;
  if (!isForeign) {
    if (year >= 1400) {
      yearTag = 'Ø¨Ø¹Ø¯Ø§Ø²Û±Û´Û°Û°';
    } else {
      const decade = Math.floor(year / 10) * 10;
      const decadeFa = String(decade).slice(-2).replace(/\d/g, d => 'Û°Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹'[d]);
      yearTag = `Ø¯Ù‡Ù‡${decadeFa}`;
    }
  } else {
    yearTag = year >= 2010 ? 'Ø¨Ø¹Ø¯Ø§Ø²2010' : 'Ù‚Ø¨Ù„â€ŒØ§Ø²2010';
  }

  const mainHashtag = `#${name.replace(/\s+/g, '_')}_${yearTag}`;
  const areaHashtag = `#Ù†Ø§Ø­ÛŒÙ‡${areaText.replace(/\s/g, '')}`;

  return [mainHashtag, areaHashtag];
}
    
	




function viewFile() {
  // Ù¾Ø§Ú©â€ŒØ³Ø§Ø²ÛŒ Ø®Ø·Ø§Ù‡Ø§
  document.querySelectorAll('.error').forEach(e => e.classList.remove('error'));

  // Ú†Ú© Ú©Ø±Ø¯Ù† ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ø§Ù„Ø²Ø§Ù…ÛŒ
  const requiredFields = [
    'code', 'area', 'brandInput', 'price', 'year', 'km','gearbox',
    'color', 'motor', 'body', 'bimeh', 'features', 'desc'
  ];

  let hasError = false;

  requiredFields.forEach(id => {
    const el = document.getElementById(id);
    if (!el.value || el.value.trim() === "") {
      el.classList.add('error');
      hasError = true;
    }
  });

  if (hasError) {
    alert("Ù„Ø·ÙØ§Ù‹ Ù‡Ù…Ù‡ ÙÛŒÙ„Ø¯Ù‡Ø§ Ø±Ø§ Ú©Ø§Ù…Ù„ Ù¾Ø± Ú©Ù†ÛŒØ¯ âŒ");
    return;
  }

  const code = document.getElementById('code').value;
  const areaSelect = document.getElementById('area');
  const areaText = areaSelect.selectedOptions[0].textContent;

  const car = document.getElementById('brandInput').value;
  let price = parseInt(document.getElementById('price').value) || 0;

  if (price < 50000000) {
    if (!confirm("âš ï¸ Ù‚ÛŒÙ…Øª ÙˆØ§Ø±Ø¯Ø´Ø¯Ù‡ Ú©Ù…ØªØ± Ø§Ø² ÛµÛ° Ù…ÛŒÙ„ÛŒÙˆÙ† ØªÙˆÙ…Ø§Ù† Ø§Ø³Øª. Ø¢ÛŒØ§ Ø§Ø² Ù‚ÛŒÙ…Øª Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ")) {
      return;
    }
  }

  const priceText = price.toLocaleString('fa-IR');

  const yearSelect = document.getElementById('year');
  const yearFa = yearSelect.selectedOptions[0].textContent;
  const yearEn = parseInt(yearSelect.value);
  const km = parseInt(document.getElementById('km').value) || 0;
  const kmWithUnit = km.toLocaleString('fa-IR');
  const gearbox = document.getElementById('gearbox').value;
  const color = document.getElementById('color').value;
  const motor = document.getElementById('motor').value;
  const body = document.getElementById('body').value;
  const bimeh = document.getElementById('bimeh').selectedOptions[0].textContent;
  const features = document.getElementById('features').value;
  const desc = document.getElementById('desc').value;

  const finalText = `ğŸ· Ú©Ø¯ ØªØ®ÙÛŒÙ: **${code}**

ğŸ“ Ù†Ø§Ø­ÛŒÙ‡: **${areaText}**

ğŸš— Ù†Ø§Ù… Ù…Ø§Ø´ÛŒÙ†: **${car}**

ğŸ’° Ù‚ÛŒÙ…Øª (ØªÙˆÙ…Ø§Ù†): **${priceText}**

ğŸ“† Ø³Ø§Ù„ ØªÙˆÙ„ÛŒØ¯: **${yearFa}**

â³ Ú©Ø§Ø±Ú©Ø±Ø¯ (Ú©ÛŒÙ„ÙˆÙ…ØªØ±): **${kmWithUnit}**

âš™ï¸ Ú¯ÛŒØ±Ø¨Ú©Ø³: **${gearbox}**

ğŸ¨ Ø±Ù†Ú¯: **${color}**

ğŸ”§ ÙˆØ¶Ø¹ÛŒØª Ù…ÙˆØªÙˆØ±: **${motor}**

ğŸ›¡ ÙˆØ¶Ø¹ÛŒØª Ø¨Ø¯Ù†Ù‡: **${body}**

ğŸ“„ Ù…Ù‡Ù„Øª Ø¨ÛŒÙ…Ù‡ Ø«Ø§Ù„Ø« (Ù…Ø§Ù‡): **${bimeh}**

âœ¨ Ø§Ù…Ú©Ø§Ù†Ø§Øª: **${features}**

ğŸ“ Ø³Ø§ÛŒØ± ØªÙˆØ¶ÛŒØ­Ø§Øª: **${desc}**

@Bongahi_bot`;

  // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± ØªØ§Ø±ÛŒØ®Ú†Ù‡
  let history = JSON.parse(localStorage.getItem('fileHistory')) || [];
  history = history.filter(item => item.code !== code);
  history.unshift({
    code: code,
    text: finalText
  });
  if (history.length > 10) history = history.slice(0, 10);
  localStorage.setItem('fileHistory', JSON.stringify(history));

  // Ù†Ù…Ø§ÛŒØ´ Ø®Ø±ÙˆØ¬ÛŒ
  const outputDiv = document.getElementById('output');
  outputDiv.innerText = finalText;
  outputDiv.style.display = 'block';
  outputDiv.style.border = '2px dashed green';
  outputDiv.style.background = '#e8fbe8';

 //const copyBtn = document.getElementById('copyBtn');
  //copyBtn.style.display = 'block';
  document.getElementById('sendBtn').style.display = 'block';    // Ù†Ù…Ø§ÛŒØ´ Ø¯Ú©Ù…Ù‡ Ø§Ø±Ø³Ø§Ù„
  document.getElementById('resetBtn').style.display = 'block';
}


  // Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ ØªÙ„Ú¯Ø±Ø§Ù…
function sendToTelegram() {
  const code = document.getElementById('code').value;
  const areaSelect = document.getElementById('area');
  const areaText = areaSelect.selectedOptions[0].textContent;
  const car = document.getElementById('brandInput').value;
  const price = parseInt(document.getElementById('price').value) || 0;
  const priceText = price.toLocaleString('fa-IR');
  const yearSelect = document.getElementById('year');
  const yearFa = yearSelect.selectedOptions[0].textContent;
  const km = parseInt(document.getElementById('km').value) || 0;
  const kmWithUnit = km.toLocaleString('fa-IR');
  const gearbox = document.getElementById('gearbox').value;
  const color = document.getElementById('color').value;
  const motor = document.getElementById('motor').value;
  const body = document.getElementById('body').value;
  const bimeh = document.getElementById('bimeh').selectedOptions[0].textContent;
  const features = document.getElementById('features').value;
  const desc = document.getElementById('desc').value;

  const data = {
    code: code,
    areaText: areaText,
    car: car,
    priceText: priceText,
    yearFa: yearFa,
    kmWithUnit: kmWithUnit,
    gearbox: gearbox,
    color: color,
    motor: motor,
    body: body,
    bimeh: bimeh,
    features: features,
    desc: desc,
  };

  const WEB_APP_URL =
    'https://script.google.com/macros/s/AKfycbyF02w8EOy04XliJ64Q_1bGsZos4rafV2FxpevdLU304bxT9PkgNm0GewxJqUX8evb2/exec';

  fetch(WEB_APP_URL, {
    method: 'POST',
    mode: 'no-cors',
    cache: 'no-cache',
    redirect: 'follow',
    body: new URLSearchParams(data),
  })
    .then((res) => res.text())
    .then((text) => {
      try {
        const data = JSON.parse(text);
        alert(data.message);
        // Ø§Ú¯Ø± Ø³Ø±ÙˆØ± Ù¾Ø§Ø³Ø® Ù…ÙˆÙÙ‚ÛŒØªâ€ŒØ¢Ù…ÛŒØ² Ø¨Ø±Ú¯Ø±Ø¯Ø§Ù†Ø¯ØŒ Ú©Ø¯ ØªØ®ÙÛŒÙ Ø±Ø§ Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†
        localStorage.setItem('previousCode', code);
      } catch (e) {
        alert('âœ… Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯!');
        // Ø§Ú¯Ø± Ø³Ø±ÙˆØ± Ù¾Ø§Ø³Ø® Ù…Ø¹ØªØ¨Ø±ÛŒ Ù†Ø¯Ø§Ø¯ØŒ Ø§Ù…Ø§ Ø§Ø±Ø³Ø§Ù„ Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯Ù‡ØŒ Ú©Ø¯ ØªØ®ÙÛŒÙ Ø±Ø§ Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†
        localStorage.setItem('previousCode', code);
      }
    })
    .catch((err) => {
      alert('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ø§Ø·Ù„Ø§Ø¹Ø§Øª: ' + err.message);
    });
}





    window.addEventListener('DOMContentLoaded', () => {
  const input = document.getElementById('code');
  const previousCode = localStorage.getItem('previousCode');
  
  // ÙÙ‚Ø· Ø§Ú¯Ø± previousCode ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯ØŒ placeholder Ø±Ø§ ØªÙ†Ø¸ÛŒÙ… Ú©Ù†
  if (previousCode && previousCode.startsWith("C-")) {
    input.placeholder = `Ú©Ø¯ ØªØ®ÙÛŒÙ Ù‚Ø¨Ù„ÛŒ: ${previousCode}`;
  }
});

   document.getElementById('code').addEventListener('focus', function () {
  if (!this.value) {
    const previousCode = localStorage.getItem('previousCode');
    if (previousCode) {
      this.value = previousCode;
    }
  }
});

    // ØªØ§Ø¨Ø¹ Ø§ÙØ²Ø§ÛŒØ´ Ø¹Ø¯Ø¯ Ø¢Ø®Ø± Ú©Ø¯ ØªØ®ÙÛŒÙ Ø¨Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ø±Ø³Øª Ù…Ù‚Ø¯Ø§Ø± Ø±Ø´ØªÙ‡
    function incrementCode() {
      const input = document.getElementById("code");
      let value = input.value.trim();

    //  if (!value) {
   //     value = localStorage.getItem("previousCode") || "";
      //  if (value) input.value = value;
    //  }

      const match = input.value.match(/^C-(\d+)-(\d+)-(\d+)$/);
      if (match) {
        const part1 = match[1];
        const part2 = match[2];
        let part3 = parseInt(match[3], 10);
        part3++;
        const newCode = `C-${part1}-${part2}-${part3}`;
        input.value = newCode;
        
    input.classList.remove('error');
      } else {
        alert("ÙØ±Ù…Øª Ú©Ø¯ ØªØ®ÙÛŒÙ Ø¨Ø§ÛŒØ¯ Ù…Ø§Ù†Ù†Ø¯ C-2345-1-2 Ø¨Ø§Ø´Ø¯.");
      }
    }

    function resetForm() {
  // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù…Ù‚Ø¯Ø§Ø± ÙÛŒÙ„Ø¯Ù‡Ø§
  document.querySelectorAll('input, select, textarea').forEach(el => {
    if (el.tagName === 'SELECT') el.selectedIndex = 0;
    else el.value = '';
  });

  // Ù¾Ù†Ù‡Ø§Ù† Ú©Ø±Ø¯Ù† Ø®Ø±ÙˆØ¬ÛŒ Ùˆ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§
  document.getElementById('output').style.display = 'none';
  document.getElementById('output').innerText = '';
  document.getElementById('sendBtn').style.display = 'none';
  document.getElementById('resetBtn').style.display = 'none';

  // Ø­Ø°Ù Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§ÛŒ Ø®Ø·Ø§
  document.querySelectorAll('.error').forEach(e => e.classList.remove('error'));

  // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù…ØªÙ†â€ŒÙ‡Ø§ÛŒ Ú©Ù…Ú©ÛŒ
  document.getElementById('priceHint').innerText = '';
  document.getElementById('kmHint').innerText = '';

  // Ø¨Ø§Ø²Ù†ÙˆÛŒØ³ÛŒ placeholder Ú©Ø¯ ØªØ®ÙÛŒÙ (Ø¯Ø± ØµÙˆØ±Øª ÙˆØ¬ÙˆØ¯)
  const input = document.getElementById('code');
  const previousCode = localStorage.getItem('previousCode');
  if (previousCode) {
    input.placeholder = `Ú©Ø¯ ØªØ®ÙÛŒÙ Ù‚Ø¨Ù„ÛŒ: ${previousCode}`;
  }
  
document.querySelectorAll('#featuresPopup input, #descPopup input').forEach(el => el.checked = false);
}


function removeErrorOnInput(id) {
  const el = document.getElementById(id);
  el.addEventListener('input', function () {
    if (el.value && el.classList.contains('error')) {
      el.classList.remove('error');
    }
  });
}

const brandInput = document.getElementById('brandInput');
const searchBrandInput = document.getElementById('searchBrandInput');
const searchModelInput = document.getElementById('searchModelInput');

let firstClickDone = false;

brandInput.addEventListener('click', openBrandPopup);

searchBrandInput.addEventListener('input', () => {
  showAllBrandsAndModelsFiltered(searchBrandInput.value.trim());
});
searchModelInput.addEventListener('input', () => {
  if (currentlySelectedBrand) {
    showModelPopup(currentlySelectedBrand, searchModelInput.value.trim());
  }
});

let currentlySelectedBrand = null;

const brands = {
 irani : ['Ø¢Ø±ÛŒØ§', 'Ù¾Ø±Ø§ÛŒØ¯', 'Ù¾Ú˜Ùˆ', 'ØªØ§Ø±Ø§', 'ØªÛŒØ¨Ø§', 'Ø¯Ù†Ø§', 'Ø±Ø§Ù†Ø§', 'Ø³Ø§ÛŒÙ†Ø§', 'Ø³Ø§ÛŒÙ¾Ø§', 'Ø³Ù…Ù†Ø¯', 'Ø´Ø§Ù‡ÛŒÙ†', 'Ú©ÙˆÛŒÛŒÚ©', 'Ú©ÛŒ Ø§Ù… Ø³ÛŒ','Ù„Ø§Ù…Ø§Ø±ÛŒ', 'ÙˆØ§Ù†Øª'],
  
  khareji: ['Ø§Ù… Ø¬ÛŒ', 'Ø§Ù… ÙˆÛŒ Ø§Ù…', 'Ø¨Ø±Ù„ÛŒØ§Ù†Ø³', 'Ø¨Ù†Ø²', 'Ø¨ÛŒâ€ŒØ§Ù…â€ŒÙˆ', 'ØªÙˆÛŒÙˆØªØ§', 'Ø¬Ú©', 'Ø¬ÛŒÙ„ÛŒ', 'Ú†Ø±ÛŒ', 'Ø±Ù†Ùˆ', 'Ø³ÛŒØªØ±ÙˆØ¦Ù†', 'Ø´ÙˆØ±ÙˆÙ„Øª', 'ÙÙˆØ±Ø¯', 'ÙÙˆÙ†ÛŒÚ©Ø³', 'Ú©ÛŒØ§', 'Ù„ÛŒÙØ§Ù†', 'Ù…ÛŒØªØ³ÙˆØ¨ÛŒØ´ÛŒ', 'Ù†ÛŒØ³Ø§Ù†', 'Ù‡Ø§ÛŒÙ…Ø§', 'Ù‡ÛŒÙˆÙ†Ø¯Ø§ÛŒ', 'ÙˆÙ„ÙˆÙˆ']
  
};

// Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ù‡Ø± Ø¨Ø±Ù†Ø¯
const models = {

'Ù¾Ú˜Ùˆ': [' Û²Û°Û¶', ' Û²Û°Û¶ SD' ,' Û²Û°Û·', ' Û´Û°Ûµ', ' Ù¾Ø§Ø±Ø³', 'ROA' ,'  RD' ,'Û²Û°Û°Û¸', 'ÛµÛ°Û¸'],

 'Ù¾Ø±Ø§ÛŒØ¯': ['Û±Û³Û±', ' Û±Û±Û±', 'Û±Û³Û²','Û±Û´Û±', 'glx', 'ØµØ¨Ø§'],
  
  'Ø¨Ø±Ù„ÛŒØ§Ù†Ø³': ['H330','H320','H230','H220','V5','Ú©Ø±Ø§Ø³'],
  
'Ø³Ù…Ù†Ø¯': ['LX', 'X7','Ø³ÙˆØ±Ù†','Ø³Ø±ÛŒØ±'],
 
  'Ø±Ø§Ù†Ø§': ['LX', 'Ù¾Ù„Ø§Ø³'],
  'Ø¯Ù†Ø§': ['Ù…Ø¹Ù…ÙˆÙ„ÛŒ', 'Ù¾Ù„Ø§Ø³'],
  'ØªØ§Ø±Ø§': ['Ù¾Ù„Ø§Ø³', 'V1', 'V2'],
  'Ø¢Ø±ÛŒØ§': ['Ú©Ø±Ø§Ø³'],
  'Ú©ÙˆÛŒÛŒÚ©': ['Ù…Ø¹Ù…ÙˆÙ„ÛŒ', 'R', 'S', 'GX'],
  'Ø´Ø§Ù‡ÛŒÙ†': ['G'],
'ØªÛŒØ¨Ø§': ['1', '2'],
'Ø³Ø§ÛŒÙ†Ø§': ['EX', 'GX','SX','S', 'Ù¾Ù„Ø§Ø³'],

'Ø³Ø§ÛŒÙ¾Ø§':['Ø§Ø·Ù„Ø³ G'],
'Ú©ÛŒ Ø§Ù… Ø³ÛŒ': ['J7', 'K7', 'X5', 'T8', 'T8 PRO'],
'Ù„Ø§Ù…Ø§Ø±ÛŒ': ['Ø§ÛŒÙ…Ø§', 'Ø§ÛŒÙ…Ø§ Ù‡ÛŒØ¨Ø±ÛŒØ¯'],
'ÙˆØ§Ù†Øª':['Ø²Ø§Ù…ÛŒØ§Ø¯','Ù¾ÛŒÚ©Ø§Ù†','Ø¢Ø±ÛŒØ³Ø§Ù†','Ù¾Ø±Ø§ÛŒØ¯ Û±ÛµÛ±','Ø±Ù†Ùˆ ØªÙ†Ø¯Ø±90','Ù…Ø²Ø¯Ø§'],

  'Ø¨Ù†Ø²': ['C200', 'E240', 'S500', 'GLK', 'CLA', 'CLS', 'SLK'],
  'Ø¨ÛŒâ€ŒØ§Ù…â€ŒÙˆ': ['Ø³Ø±ÛŒ Û³', 'Ø³Ø±ÛŒ Ûµ', 'Ø³Ø±ÛŒ Û·', 'X1', 'X3', 'X5', 'i8'],
  'ØªÙˆÛŒÙˆØªØ§': ['Ú©Ø±ÙˆÙ„Ø§', 'ÛŒØ§Ø±ÛŒØ³', 'Ú©Ù…Ø±ÛŒ', 'Ø±Ø§ÙˆÙÙˆØ±', 'Ù¾Ø±Ø§Ø¯Ùˆ', 'Ù„Ù†Ø¯Ú©Ø±ÙˆØ²Ø±', 'Ù‡Ø§ÛŒÙ„ÙˆÚ©Ø³', 'Ø§Ùâ€ŒØ¬ÛŒ Ú©Ø±ÙˆØ²Ø±'],
  'Ù‡ÛŒÙˆÙ†Ø¯Ø§ÛŒ': ['Ø³ÙˆÙ†Ø§ØªØ§', 'Ø§Ù„Ù†ØªØ±Ø§', 'ØªÙˆØ³Ø§Ù†', 'Ø³Ø§Ù†ØªØ§ÙÙ‡', 'Ø¢Ø²Ø±Ø§', 'i20', 'i30'],
  'Ú©ÛŒØ§': ['Ø³Ø±Ø§ØªÙˆ', 'Ø§Ù¾ØªÛŒÙ…Ø§', 'Ø³ÙˆØ±Ù†ØªÙˆ', 'Ø§Ø³Ù¾ÙˆØ±ØªÛŒØ¬', 'Ø±ÛŒÙˆ', 'Ù¾ÛŒÚ©Ø§Ù†ØªÙˆ', 'Ù…ÙˆÙ‡Ø§ÙˆÛŒ'],
 'Ø±Ù†Ùˆ': ['Ø±Ù†Ùˆ ØªÙ†Ø¯Ø± Û¹Û°'],
  'Ù†ÛŒØ³Ø§Ù†': ['Ù…Ø§Ú©Ø³ÛŒÙ…Ø§', 'ØªÛŒØ§Ù†Ø§', 'Ù‚Ø´Ù‚Ø§ÛŒÛŒ', 'Ø§ÛŒÚ©Ø³â€ŒØªØ±ÛŒÙ„', 'Ù¾Ø§ØªØ±ÙˆÙ„', 'Ø¬ÙˆÚ©', 'Ø±ÙˆÙ†ÛŒØ²'],
  'Ù…ÛŒØªØ³ÙˆØ¨ÛŒØ´ÛŒ': ['Ù„Ù†Ø³Ø±', 'Ø§ÙˆØªÙ„Ù†Ø¯Ø±', 'Ù¾Ø§Ø¬Ø±Ùˆ', 'ASX'],
  
  'Ø§Ù… ÙˆÛŒ Ø§Ù…': ['110', '110s', '315', '530', '550', 'X22', 'X22 Pro', 'X33', 'X33s', 'X55', 'X55 Pro', 'X65'],
  'Ú†Ø±ÛŒ': ['Ø¢Ø±ÛŒØ²Ùˆ Ûµ', 'Ø¢Ø±ÛŒØ²Ùˆ Û¶', 'ØªÛŒÚ¯Ùˆ Ûµ', 'ØªÛŒÚ¯Ùˆ Û·', 'ØªÛŒÚ¯Ùˆ Û¸'],
  
'ÙÙˆÙ†ÛŒÚ©Ø³': ['FX' ,'Ø¢Ø±ÛŒØ²Ùˆ Û¶', 'Ø¢Ø±ÛŒØ²Ùˆ Û¸','ØªÛŒÚ¯Ùˆ Û· Pro', 'ØªÛŒÚ¯Ùˆ Û¸ Pro'],
  'Ø¬Ú©': ['J3', 'J4', 'J5', 'S3', 'S5', 'J7'],
  'Ù„ÛŒÙØ§Ù†': ['X50', 'X60', '620', '820'],
  'Ø§Ù… Ø¬ÛŒ': ['MG3', 'MG6', 'MG350', 'MG GS', 'MG RX5'],
  'Ø³ÛŒØªØ±ÙˆØ¦Ù†': ['C3', 'C5', 'Ø²Ø§Ù†ØªÛŒØ§'],
  'ÙˆÙ„ÙˆÙˆ': ['S60', 'S80', 'XC60', 'XC90'],
  'ÙÙˆØ±Ø¯': ['Ù…ÙˆØ³ØªØ§Ù†Ú¯', 'ÙÛŒØ³ØªØ§', 'ÙÛŒÙˆÚ˜Ù†', 'Ø§Ø³Ú©ÛŒÙ¾'],
  'Ø´ÙˆØ±ÙˆÙ„Øª': ['Ú©Ø§Ù¾Ø±ÛŒØ³', 'Ø§Ù¾ØªØ±Ø§', 'Ø¢ÙˆØ§Ù†ØªØ§'],
  'Ø¬ÛŒÙ„ÛŒ': ['Ø§Ù…Ú¯Ø±Ù†Ø¯ 7', 'Ø§Ù…Ú¯Ø±Ù†Ø¯ X7'],
'Ù‡Ø§ÛŒÙ…Ø§': ['S5', 'S5 Ù¾Ù„Ø§Ø³', 'S5 Ù¾Ø±Ùˆ', 'S7', 'S7 ØªÙˆØ±Ø¨ÙˆØ´Ø§Ø±Ú˜', 'S7 Ù¾Ù„Ø§Ø³', '8S', '7X']
};

// ØªÛŒÙ¾â€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ Ø¨Ø±Ø®ÛŒ Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ø®Ø§Øµ
const modelsWithTip = {
  ' Û²Û°Û¶': ['ØªÛŒÙ¾ Û²', 'ØªÛŒÙ¾ Û³', 'ØªÛŒÙ¾ Ûµ'],
  
 ' Û²Û°Û·': ['TU5', 'TU3'],
 
' LX':['EF7','Ø³Ø§Ø¯Ù‡'],

' Ø³ÙˆØ±Ù†': ['ELX', 'ØªÙˆØ±Ø¨Ùˆ','Ù¾Ù„Ø§Ø³','Ø³Ø§Ø¯Ù‡'],
   ' Ù¾Ø§Ø±Ø³': ['XU7P', 'XU7','ELX','TU5', 'Ø³Ø§Ù„'],
  'Ø¯Ù†Ø§ Ù¾Ù„Ø§Ø³': ['Ù…Ø¹Ù…ÙˆÙ„ÛŒ', 'ØªÙˆØ±Ø¨Ùˆ', 'ØªÙˆØ±Ø¨Ùˆ Ø´Ø§Ø±Ú˜ Ø§ØªÙˆÙ…Ø§Øª'],
  'Ø±Ù†Ùˆ ØªÙ†Ø¯Ø± Û¹Û°': ['E0','E1', 'E2', 'Ù¾Ù„Ø§Ø³'],
  
'ØªÛŒØ¨Ø§ 1': ['EX', 'SX', 'Ù¾Ù„Ø§Ø³'],
  'ØªÛŒØ¨Ø§ 2': ['EX', 'SX', 'Ù¾Ù„Ø§Ø³'],
'Ù…Ø²Ø¯Ø§': ['ØªÚ© Ú©Ø§Ø¨ÛŒÙ†','Ø¯Ùˆ Ú©Ø§Ø¨ÛŒÙ†'],

'Ø²Ø§Ù…ÛŒØ§Ø¯': [' Z24', ' Ø¯ÛŒØ²Ù„ÛŒ', 'Ù¾Ø§Ø¯Ø±Ø§', 'Ù¾Ø§Ø¯Ø±Ø§ Ù¾Ù„Ø§Ø³', 'Ú©Ø§Ø±ÙˆÙ†'],
'110': ['Ø³Ù‡ Ø³ÛŒÙ„Ù†Ø¯Ø±', 'Ú†Ù‡Ø§Ø± Ø³ÛŒÙ„Ù†Ø¯Ø±'],
'315': ['Ù‡Ø§Ú†â€ŒØ¨Ú©', 'Ù‡Ø§Ú†â€ŒØ¨Ú© Ù¾Ù„Ø§Ø³', 'ØµÙ†Ø¯ÙˆÙ‚â€ŒØ¯Ø§Ø±'],
'X22': ['Ø³Ø§Ø¯Ù‡', 'Ø§Ø³Ù¾Ø±Øª', 'Ù„Ø§Ú©Ú†Ø±ÛŒ'],
'X33s': ['Ø³Ø§Ø¯Ù‡', 'Ø§Ø³Ù¾Ø±Øª', 'Ù†ÛŒÙˆÙÛŒØ³'],
'X55': ['Ø§Ú©Ø³Ù„Ù†Øª', 'Ø§Ú©Ø³Ù„Ù†Øª Ø§Ø³Ù¾Ø±Øª'],
'X55 Pro': ['Ø§Ú©Ø³Ù„Ù†Øª', 'IE'],
  'FX': ['Ù…Ø¹Ù…ÙˆÙ„ÛŒ','Ø¨Ø±Ù‚ÛŒ','Premium'],
  
    'Ø¢Ø±ÛŒØ²Ùˆ Û¶': ['Pro', 'GT'],
    'ØªÛŒÚ¯Ùˆ Û· Pro':['Ù…Ø¹Ù…ÙˆÙ„ÛŒ','ePlus','Premium', 'Max'],
    'ØªÛŒÚ¯Ùˆ Û¸ Pro': ['Ù…Ø¹Ù…ÙˆÙ„ÛŒ','ePlus','Max IE', 'Max'],
'Ø³Ø±Ø§ØªÙˆ': ['1600cc', '2000cc','Ø³Ø§ÛŒÙ¾Ø§'],
'Ø§Ù¾ØªÛŒÙ…Ø§': ['EX', 'GTLine', 'Ù‡ÛŒØ¨Ø±ÛŒØ¯'],
'Ø³ÙˆØ±Ù†ØªÙˆ': ['GTLine', 'Ø³Ø§Ø¯Ù‡'],
'Ø§Ø³Ù¾ÙˆØ±ØªÛŒØ¬': ['2000cc', '2400cc', 'GT-Line', 'ØªÙˆØ±Ø¨Ùˆ'],
'Ú©Ø±ÙˆÙ„Ø§': ['GLi', 'XLi', 'Ù‡ÛŒØ¨Ø±ÛŒØ¯', 'Ú©Ø±Ø§Ø³â€ŒÙ‡ÛŒØ¨Ø±ÛŒØ¯', 'ØªÙˆØ±Ø¨Ùˆ', 'Ú©Ù„Ø§Ø³ÛŒÚ©'],
'ÛŒØ§Ø±ÛŒØ³': ['Ù‡Ø§Ú†â€ŒØ¨Ú©', 'ØµÙ†Ø¯ÙˆÙ‚â€ŒØ¯Ø§Ø±'],

'Ú©Ù…Ø±ÛŒ': ['GL', 'GLX', 'XLI', 'SE', 'Ú¯Ø±Ù†Ø¯', 'Ù‡ÛŒØ¨Ø±ÛŒØ¯'],
'Ù¾Ø±Ø§Ø¯Ùˆ': ['VX', 'TX', 'GX', 'Ø¢Ù†Ø±ÙˆØ¯', 'Ø¢ÙØ±ÙˆØ¯'],
'Ù„Ù†Ø¯Ú©Ø±ÙˆØ²Ø±': ['Û¶ Ø³ÛŒÙ„Ù†Ø¯Ø±', 'Û¸ Ø³ÛŒÙ„Ù†Ø¯Ø±'],
'Ø±Ø§ÙˆÙÙˆØ±': ['ØªÚ© Ø¯ÛŒÙØ±Ø§Ù†Ø³ÛŒÙ„', 'Ø¯Ùˆ Ø¯ÛŒÙØ±Ø§Ù†Ø³ÛŒÙ„'],
'Ø³ÙˆÙ†Ø§ØªØ§': ['GL', 'GLS', 'GLS Plus', 'YF', 'LF', 'NF'],
'Ø§Ù„Ù†ØªØ±Ø§': ['1600cc', '1800cc', '2000cc'],
'Ø¢Ø²Ø±Ø§': ['IG', 'HG', 'TG'],
'Ø³Ø§Ù†ØªØ§ÙÙ‡': ['2400cc', '2700cc', '3300cc', 'GDi'],
'ØªÙˆØ³Ø§Ù†': ['2000cc', '2400cc', '2700cc']

};



function openBrandPopup() {
  openPopup('popupBrand');
  document.getElementById('popupModel').style.display = 'none';
  showBrandList('irani');
}

function setYearOptions(isForeign) {
  const yearSelect = document.getElementById('year');
  yearSelect.innerHTML = '';

  if (isForeign) {
    for (let y = 2025; y >= 1980; y--) {
      const option = document.createElement('option');
      option.value = y;
      option.textContent = y.toString();
      yearSelect.appendChild(option);
    }
  } else {
    for (let y = 1404; y >= 1350; y--) {
      const option = document.createElement('option');
      option.value = y;
      option.textContent = y.toString().replace(/\d/g, d => 'Û°Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹'[d]);
      yearSelect.appendChild(option);
    }
  }
}


function showBrandList(type, filter = '') {
  const list = document.getElementById('brandList');
  list.innerHTML = '';

document.getElementById('popupOverlay').style.display = 'block';

  // Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ Ø±Ùˆ Ù¾ÛŒØ¯Ø§ Ú©Ù† Ùˆ Ú©Ù„Ø§Ø³ active Ø±Ùˆ Ø­Ø°Ù Ú©Ù†
  const buttons = document.querySelectorAll('#popupBrand button');
  buttons.forEach(btn => btn.classList.remove('active'));

  // Ø¯Ú©Ù…Ù‡ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ù†ÙˆØ¹ Ø§Ù†ØªØ®Ø§Ø¨â€ŒØ´Ø¯Ù‡ Ø±Ùˆ active Ú©Ù†
  const activeBtn = document.querySelector(`#popupBrand button[onclick="showBrandList('${type}')"]`);
  if (activeBtn) activeBtn.classList.add('active');

  const filteredBrands = brands[type].filter(brand => brand.includes(filter));

  filteredBrands.forEach(brand => {
    const li = document.createElement('li');
    li.textContent = brand;
    li.onclick = () => {
currentlySelectedBrand = brand;
  const popupBrand = document.getElementById('popupBrand');
popupBrand.classList.add('hidden');
setTimeout(() => {
  popupBrand.style.display = 'none';
  popupBrand.classList.remove('hidden');
}, 300);
  showModelPopup(brand, '', false); // Ø¨Ø¯ÙˆÙ† Ø¬Ø³ØªØ¬Ùˆ
  
searchBrandInput.value = '';
};
    list.appendChild(li);
  });
}
function showAllBrandsAndModelsFiltered(filter = '') {
  const list = document.getElementById('brandList');
  list.innerHTML = '';

  const normalizedFilter = normalize(filter);
  
  for (const brandType in brands) {
    brands[brandType].forEach(brand => {
      const allModels = models[brand] || [];

      allModels.forEach(model => {
        const fullText = `${brand} ${model}`;
        if (normalize(fullText).includes(normalizedFilter) || normalize(brand).includes(normalizedFilter) || normalize(model).includes(normalizedFilter)) {
          const li = document.createElement('li');
          li.textContent = `${brand} - ${model}`;
          li.onclick = () => {
currentlySelectedBrand = brand;
            const fullModel = `${brand} - ${model}`;
            

            const isForeign = brands['khareji'].some(b => normalize(b) === normalize(brand));
            setYearOptions(isForeign);

            if (modelsWithTip[model]) {
  closePopup();
  setTimeout(() => showTipPopup(fullModel, model), 300);
            } else {
              document.getElementById('brandInput').value = fullModel;
              const popupBrand = document.getElementById('popupBrand');
popupBrand.classList.add('hidden');
setTimeout(() => {
  popupBrand.style.display = 'none';
  popupBrand.classList.remove('hidden');
}, 300);

const popupModel = document.getElementById('popupModel');
popupModel.classList.add('hidden');
setTimeout(() => {
  popupModel.style.display = 'none';
  popupModel.classList.remove('hidden');
}, 300);

const popupTip = document.getElementById('popupTip');
popupTip.classList.add('hidden');
setTimeout(() => {
  popupTip.style.display = 'none';
  popupTip.classList.remove('hidden');
}, 300);
document.getElementById('popupOverlay').style.display = 'none';
            }
searchBrandInput.value = '';
          };
          list.appendChild(li);
        }
      });
    });
  }
// Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¨Ù‡ popup Ø¨Ø±Ù†Ø¯
setTimeout(() => {
  const popup = document.getElementById('popupBrand');
  if (popup) popup.scrollIntoView({ behavior: 'smooth', block: 'center' });
}, 100);
}
function normalize(str) {
  return str.replace(/[â€Œ\s]/g, '').replace(/[Û°-Û¹]/g, d => 'Û°Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹'.indexOf(d).toString()).toLowerCase();
}

function showModelPopup(brand, filter = '', showSearch = true) {
  currentlySelectedBrand = brand;
  const list = document.getElementById('modelList');
  list.innerHTML = '';

  document.getElementById('popupTip').style.display = 'none';
  openPopup('popupModel');


  const modelSearchInput = document.getElementById('searchModelInput');
  if (modelSearchInput) {
    modelSearchInput.style.display = showSearch ? 'block' : 'none';
  }

  const normalizedFilter = normalize(filter);
  const filteredModels = models[brand].filter(model => normalize(model).includes(normalizedFilter));
  
  filteredModels.forEach(model => {
    const li = document.createElement('li');
    li.textContent = model;
    li.onclick = () => {
      const fullModel = brand + ' - ' + model;

      // ØªØ´Ø®ÛŒØµ Ø¨Ø±Ù†Ø¯ Ø®Ø§Ø±Ø¬ÛŒ ÛŒØ§ Ø§ÛŒØ±Ø§Ù†ÛŒ:
      const cleanBrand = normalize(brand);
      const isForeign = brands['khareji'].some(b => normalize(b) === cleanBrand);
      
      setYearOptions(isForeign);

      if (modelsWithTip[model]) {
        document.getElementById('popupModel').style.display = 'none';
        showTipPopup(fullModel, model);
      } else {
        document.getElementById('brandInput').value = fullModel;
        const popupModel = document.getElementById('popupModel');
popupModel.classList.add('hidden');
setTimeout(() => {
  popupModel.style.display = 'none';
  popupModel.classList.remove('hidden');
}, 300);
document.getElementById('popupOverlay').style.display = 'none';
      }
    };
    list.appendChild(li);
  });

  // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø±ÙˆÛŒØ¯Ø§Ø¯ Ú©Ù„ÛŒÚ© Ø¨Ù‡ Ø¯Ú©Ù…Ù‡ Ø¨Ø§Ø²Ú¯Ø´Øª
  const backButton = document.querySelector('.back-button'); // ÙØ±Ø¶ Ø¨Ø± Ø§ÛŒÙ† Ø§Ø³Øª Ú©Ù‡ Ø¯Ú©Ù…Ù‡ Ø¨Ø§Ø²Ú¯Ø´Øª Ø¯Ø§Ø±Ø§ÛŒ Ú©Ù„Ø§Ø³ back-button Ø§Ø³Øª
  if (backButton) {
    backButton.addEventListener('click', function(event) {
      event.stopPropagation(); // Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø§Ù†ØªØ´Ø§Ø± Ø±ÙˆÛŒØ¯Ø§Ø¯ Ú©Ù„ÛŒÚ© Ø¨Ù‡ ÙˆØ§Ù„Ø¯ÛŒÙ†
      backToBrands(); // Ø§Ø¬Ø±Ø§ÛŒ ØªØ§Ø¨Ø¹ Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø¨Ø±Ù†Ø¯Ù‡Ø§
    });
  }

  // Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¨Ù‡ popup Ù…Ø¯Ù„
  setTimeout(() => {
    const popup = document.getElementById('popupModel');
    if (popup) popup.scrollIntoView({ behavior: 'smooth', block: 'center' });
  }, 100);
}

function showTipPopup(fullModel, modelKey) {
  const list = document.getElementById('tipList');
  list.innerHTML = '';
  openPopup('popupTip');
  modelsWithTip[modelKey].forEach(tip => {
    const li = document.createElement('li');
    li.textContent = tip;
    li.onclick = () => {
      document.getElementById('brandInput').value = fullModel + ' - ' + tip;

      // Ø¨Ø³ØªÙ† Ù‡Ù…Ù‡ Ù¾Ø§Ù¾â€ŒØ¢Ù¾â€ŒÙ‡Ø§
      while (popupStack.length > 0) {
        closePopup();
      }

      // Ø®Ø§Ù…ÙˆØ´ Ú©Ø±Ø¯Ù† overlay
      document.getElementById('popupOverlay').style.display = 'none';
    };
    list.appendChild(li);
  });
}

function backToBrands() {
  // ÙÙ‚Ø· Ø¨Ø³ØªÙ† popupModel Ø¨Ø¯ÙˆÙ† Ø¯Ø³Øª Ø²Ø¯Ù† Ø¨Ù‡ stack
  const popupModel = document.getElementById('popupModel');
  popupModel.classList.add('hidden');
  setTimeout(() => {
    popupModel.style.display = 'none';
    popupModel.classList.remove('hidden');
  }, 300);

  openPopup('popupBrand'); // Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø¨Ù‡ Ø§Ø³ØªÚ© push Ù…ÛŒâ€ŒØ´ÙˆØ¯
  
  if (!currentlySelectedBrand) {
    showBrandList('irani');
    return;
  }

  const normalized = normalize(currentlySelectedBrand);
  const isForeign = brands.khareji.some(b => normalize(b) === normalized);
  showBrandList(isForeign ? 'khareji' : 'irani');
}

function backToModels() {
 closePopup();
  openPopup('popupModel');
}

  function openFeaturesPopup() {
openPopup('featuresPopup'); // Ø§Ù…Ú©Ø§Ù†Ø§Øª

}
  function confirmFeatures() {
    const checkboxes = document.querySelectorAll('#featuresPopup input[type="checkbox"]');
    const selected = [];

    checkboxes.forEach(chk => {
      if (chk.checked) selected.push(chk.value);
    });

    const featuresTextarea = document.getElementById('features');
      featuresTextarea.value = selected.join(' - ');
      closePopup();
  }

function openDescPopup() {
    openPopup('descPopup');

  }

  function confirmDesc() {
  const checkboxes = document.querySelectorAll('#descPopup input');
  const selected = [];

  

  let dualChecked = false;
  let dualValue = "";

  let taxiChecked = false;
  let taxiValue = "";

let rangChecked = false;
  let rangs = [];
  
  let shassiChecked = false;
  let shassies = [];

let consumableChecked = false;
  const consumables = [];
  
  checkboxes.forEach(chk => {
    if (chk.id === "consumableToggle") {
      consumableChecked = chk.checked;
    } else if (chk.name === "consumableItem" && chk.checked) {
      consumables.push(chk.value);
    } else if (chk.id === "dualToggle") {
      dualChecked = chk.checked;
    } else if (chk.name === "dualType" && chk.checked) {
      dualValue = chk.value;
    } else if (chk.id === "taxiToggle") {
      taxiChecked = chk.checked;
    } else if (chk.name === "taxiType" && chk.checked) {
      taxiValue = chk.value;
    } else if (chk.id === "shassiToggle") {
    shassiChecked = chk.checked;
  } else if (chk.name === "shassi" && chk.checked) {
    shassies.push(chk.value);
  }
else if (chk.id === "rangToggle") {
  rangChecked = chk.checked;
} else if (chk.name === "rang" && chk.checked) {
  rangs.push(chk.value);
}
  else if (
      chk.checked &&
      chk.name !== "dualType" &&
      chk.name !== "taxiType" &&
chk.name !== "rang" &&
chk.name !== "shassi" &&
chk.name !== "consumableItem" 
    ) {
      selected.push(chk.value);
    }
  });

  if (dualChecked && dualValue) {
    selected.push(`Ø¯ÙˆÚ¯Ø§Ù†Ù‡ (${dualValue})`);
  }

  if (taxiChecked && taxiValue) {
    selected.push(`ØªØ§Ú©Ø³ÛŒ (${taxiValue})`);
  }
if (rangChecked && rangs.length > 0) {
  selected.push(`ÙˆØ¶Ø¹ÛŒØª Ø±Ù†Ú¯ Ø´Ø¯Ú¯ÛŒ(${rangs.join("ØŒ ")})`);
}
  if (shassiChecked && shassies.length > 0) {
  selected.push(`ÙˆØ¶Ø¹ÛŒØª Ø´Ø§Ø³ÛŒ (${shassies.join("ØŒ ")})`);
}

if (consumableChecked && consumables.length > 0) {
    selected.push(`Ù…ØµØ±ÙÛŒâ€ŒÙ‡Ø§ÛŒ ØªØ§Ø²Ù‡ ØªØ¹ÙˆÛŒØ¶ Ø´Ø¯Ù‡ (${consumables.join("ØŒ ")})`);
  }

  const descTextarea = document.getElementById('desc');
  descTextarea.value = selected.join(" - ");
  closePopup();
}
function toggleConsumables() {
  const checkbox = document.getElementById("consumableToggle");
  const radios = document.getElementById("consumablesRadios");

  if (checkbox.checked) {
    radios.style.display = "grid";
    // Ø§Ø³Ú©Ø±ÙˆÙ„ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ø±Ø§ÛŒ Ø¯ÛŒØ¯Ù‡ Ø´Ø¯Ù† Ø²ÛŒØ±Ù…Ø¬Ù…ÙˆØ¹Ù‡
    setTimeout(() => {
      checkbox.closest('label')?.scrollIntoView({ behavior: "smooth", block: "start" });
    }, 100);
  } else {
    radios.style.display = "none";
  }
}
function toggleDualType() {
  const checkbox = document.getElementById("dualToggle");
  const box = document.getElementById("dualTypeRadios");
  box.style.display = checkbox.checked ? "grid" : "none";

  if (checkbox.checked) {
    box.scrollIntoView({ behavior: "smooth", block: "nearest" });
  }
}

function toggleRangType() {
  const checkbox = document.getElementById("rangToggle");
  const radios = document.getElementById("rangTypeRadios");

  if (checkbox.checked) {
    radios.style.display = "grid";
    setTimeout(() => {
      checkbox.closest('label')?.scrollIntoView({ behavior: "smooth", block: "start" });
    }, 100);
  } else {
    radios.style.display = "none";
  }
}

function toggleShassiType() {
  const checkbox = document.getElementById("shassiToggle");
  const radios = document.getElementById("shassiTypeRadios"); // Ù…Ø·Ù…Ø¦Ù† Ø´Ùˆ id Ø¯Ø± HTML Ù‡Ù… Ù‡Ù…ÛŒÙ†Ù‡

  if (checkbox.checked) {
    radios.style.display = "grid";
    // Ø§Ø³Ú©Ø±ÙˆÙ„ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ø±Ø§ÛŒ Ø¯ÛŒØ¯Ù‡ Ø´Ø¯Ù†
    setTimeout(() => {
      checkbox.closest('label')?.scrollIntoView({ behavior: "smooth", block: "start" });
    }, 100);
  } else {
    radios.style.display = "none";
  }
}

function toggleTaxiType() {
  const checkbox = document.getElementById("taxiToggle");
  const box = document.getElementById("taxiTypeRadios");
  box.style.display = checkbox.checked ? "grid" : "none";

  if (checkbox.checked) {
    box.scrollIntoView({ behavior: "smooth", block: "nearest" });
  }
}
function showHistory() {
  // Ù¾Ø§Ú©â€ŒØ³Ø§Ø²ÛŒ Ø§Ø³ØªÚ© Ùˆ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² ØªÚ©Ø±Ø§Ø± Ø¯Ø± history
  popupStack.length = 0;
  window.popupOpened = false;

  // ÙÙ‚Ø· ÛŒÚ©Ø¨Ø§Ø± history Ø«Ø¨Øª Ú©Ù†
  window.history.pushState({ popupId: 'historyPopup' }, '', '#popup-history');

  const popup = document.getElementById('historyPopup');
  const list = document.getElementById('historyList');
  const history = JSON.parse(localStorage.getItem('fileHistory')) || [];

 

function extractLastNumber(code) {
  const parts = code.split('-');
  const lastPart = parts[parts.length - 1];
  return parseInt(lastPart, 10) || 0;
}

history.sort((a, b) => extractLastNumber(a.code) - extractLastNumber(b.code));

  if (history.length === 0) {
    alert("ğŸ“­ Ù‡ÛŒÚ† ÙØ§ÛŒÙ„ÛŒ Ø¯Ø± ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù†ÛŒØ³Øª.");
    return;
  }

  list.innerHTML = ''; // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù‚Ø¨Ù„ÛŒ

  history.forEach((item, index) => {
    const li = document.createElement('li');
    li.textContent = item.code;
    li.style.cursor = 'pointer';
    li.style.padding = '8px 10px';
    li.style.borderBottom = '1px dashed #ccc';
    let holdTimer = null;


function startHoldToDelete() {
  holdTimer = setTimeout(() => {
    if (confirm(`âŒ Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ú©Ø¯ "${item.code}" Ø±Ø§ Ø­Ø°Ù Ú©Ù†ÛŒØ¯ØŸ`)) {
      deleteHistoryItem(item.code);
      showHistory();
    }
  }, 1300); // Ø¯Ùˆ Ø«Ø§Ù†ÛŒÙ‡ Ù†Ú¯Ù‡â€ŒØ¯Ø§Ø´ØªÙ†
}

function cancelHoldToDelete() {
  clearTimeout(holdTimer);
}

li.addEventListener('mousedown', startHoldToDelete);
li.addEventListener('mouseup', cancelHoldToDelete);
li.addEventListener('mouseleave', cancelHoldToDelete);

li.addEventListener('touchstart', startHoldToDelete);
li.addEventListener('touchend', cancelHoldToDelete);
li.addEventListener('touchcancel', cancelHoldToDelete);

li.addEventListener('click', () => {
  // ÙÙ‚Ø· Ø§Ú¯Ø± Ø­Ø°Ù ÙØ¹Ø§Ù„ Ù†Ø´Ø¯Ù‡ Ø¨ÙˆØ¯
  document.getElementById('detailsText').innerText = item.text;
  document.getElementById('detailsPopup').style.display = 'block';
  window.selectedHistoryItem = item;
});
    list.appendChild(li);
  });

  popup.style.display = 'flex';
}


function fillFormWithHistory(item) {
  const lines = item.text.split('\n').map(line => line.trim());

  document.getElementById('code').value = extractValue(lines[0]);
document.getElementById('area').value = convertToEnglishNumber(extractValue(lines[2]));
  document.getElementById('brandInput').value = extractValue(lines[4]);
  document.getElementById('price').value = convertToEnglishNumber(extractValue(lines[6]));
  document.getElementById('year').value = convertToEnglishNumber(extractValue(lines[8]));
  document.getElementById('km').value = convertToEnglishNumber(extractValue(lines[10]));
document.getElementById('gearbox').value = extractValue(lines[12]);
  document.getElementById('color').value = extractValue(lines[14]);
  document.getElementById('motor').value = extractValue(lines[16]);
  document.getElementById('body').value = extractValue(lines[18]);
  document.getElementById('bimeh').value = convertToEnglishNumber(extractValue(lines[20]));
  document.getElementById('features').value = extractValue(lines[22]);
  document.getElementById('desc').value = extractValue(lines[24]);


  updatePriceLabel();
  updateKmLabel();
// ØªØ´Ø®ÛŒØµ Ø§ÛŒÙ†Ú©Ù‡ Ø¨Ø±Ù†Ø¯ Ø§ÛŒØ±Ø§Ù†ÛŒÙ‡ ÛŒØ§ Ø®Ø§Ø±Ø¬ÛŒ
const brandLine = extractValue(lines[2]);
const brandName = brandLine.split('-')[0].trim();
const isForeign = brands['khareji'].includes(brandName);

// ØªØºÛŒÛŒØ± Ù†ÙˆØ¹ Ø³Ø§Ù„â€ŒÙ‡Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¨Ø±Ù†Ø¯
setYearOptions(isForeign);
}

// Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù…Ù‚Ø¯Ø§Ø± Ù¾Ø³ Ø§Ø² Ø¯Ùˆ Ù†Ù‚Ø·Ù‡
function extractValue(line) {
  const raw = line.split(':')[1]?.trim() || '';
  return raw.replace(/\*\*/g, '').trim();
}

// ØªØ¨Ø¯ÛŒÙ„ Ø§Ø¹Ø¯Ø§Ø¯ ÙØ§Ø±Ø³ÛŒ Ø¨Ù‡ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ
function convertToEnglishNumber(faStr) {
  return faStr.replace(/[Û°-Û¹]/g, d => 'Û°Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹'.indexOf(d)).replace(/[^\d]/g, '');
}


function applyDetailsEdit() {
  if (!window.selectedHistoryItem) return;

  fillFormWithHistory(window.selectedHistoryItem);
  document.getElementById('detailsPopup').style.display = 'none';
  document.getElementById('historyPopup').style.display = 'none';
}

function deleteHistoryItem(code) {
  let history = JSON.parse(localStorage.getItem('fileHistory')) || [];
  history = history.filter(item => item.code !== code);
  localStorage.setItem('fileHistory', JSON.stringify(history));
}
document.addEventListener('click', function(event) {
  const brandInput = document.getElementById('brandInput');
  const featuresInput = document.getElementById('features');
  const descInput = document.getElementById('desc');

  const popupBrand = document.getElementById('popupBrand');
  const featuresPopup = document.getElementById('featuresPopup');
  const descPopup = document.getElementById('descPopup');

  // Ø§Ú¯Ø± Ú©Ù„ÛŒÚ© Ø®Ø§Ø±Ø¬ Ø§Ø² Ø¨Ø±Ù†Ø¯ ÛŒØ§ Ù¾Ø§Ù¾â€ŒØ¢Ù¾ Ø¨Ø±Ù†Ø¯ Ø¨ÙˆØ¯ØŒ Ù¾Ø§Ù¾â€ŒØ¢Ù¾ Ø¨Ø±Ù†Ø¯ Ø¨Ø³ØªÙ‡ Ø´ÙˆØ¯
  if (
    !brandInput.contains(event.target) && 
    !popupBrand.contains(event.target)
  ) {
    popupBrand.classList.add('hidden');
setTimeout(() => {
  popupBrand.style.display = 'none';
  popupBrand.classList.remove('hidden');
}, 300);
  }

  // Ø§Ú¯Ø± Ú©Ù„ÛŒÚ© Ø®Ø§Ø±Ø¬ Ø§Ø² Ø§Ù…Ú©Ø§Ù†Ø§Øª ÛŒØ§ Ù¾Ø§Ù¾â€ŒØ¢Ù¾ Ø§Ù…Ú©Ø§Ù†Ø§Øª Ø¨ÙˆØ¯ØŒ Ù¾Ø§Ù¾â€ŒØ¢Ù¾ Ø§Ù…Ú©Ø§Ù†Ø§Øª Ø¨Ø³ØªÙ‡ Ø´ÙˆØ¯
  if (
    !featuresInput.contains(event.target) && 
    !featuresPopup.contains(event.target)
  ) {
    featuresPopup.classList.add('hidden');
setTimeout(() => {
  featuresPopup.style.display = 'none';
  featuresPopup.classList.remove('hidden');
}, 300);
  }

  // Ø§Ú¯Ø± Ú©Ù„ÛŒÚ© Ø®Ø§Ø±Ø¬ Ø§Ø² ØªÙˆØ¶ÛŒØ­Ø§Øª ÛŒØ§ Ù¾Ø§Ù¾â€ŒØ¢Ù¾ ØªÙˆØ¶ÛŒØ­Ø§Øª Ø¨ÙˆØ¯ØŒ Ù¾Ø§Ù¾â€ŒØ¢Ù¾ ØªÙˆØ¶ÛŒØ­Ø§Øª Ø¨Ø³ØªÙ‡ Ø´ÙˆØ¯
  if (
    !descInput.contains(event.target) && 
    !descPopup.contains(event.target)
  ) {
   descPopup.classList.add('hidden');
setTimeout(() => {
  descPopup.style.display = 'none';
  descPopup.classList.remove('hidden');
}, 300);
  }
});


searchBrandInput.addEventListener('focus', () => {
  setTimeout(() => {
    const popup = document.getElementById('popupBrand');
    if (popup) popup.scrollIntoView({ behavior: 'smooth', block: 'center' });
  }, 300);
});

searchModelInput.addEventListener('focus', () => {
  setTimeout(() => {
    const popup = document.getElementById('popupModel');
    if (popup) popup.scrollIntoView({ behavior: 'smooth', block: 'center' });
  }, 300);
});

document.getElementById('popupOverlay').onclick = () => {
  while (popupStack.length > 0) {
    closePopup(); // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ØªØ§Ø¨Ø¹ Ø¨Ø§ Ø§Ù†ÛŒÙ…ÛŒØ´Ù†
  }
};

const popupStack = [];

function openPopup(id) {
  const popup = document.getElementById(id);
  if (!popup) return;

  popup.classList.remove('hidden');
  popup.style.display = 'block';

  requestAnimationFrame(() => {
    popup.classList.add('show');
  });

  document.getElementById('popupOverlay').style.display = 'block';


 if (popupStack.length === 0) {
  history.pushState({ popupId: id }, '', `#popup-${id}`);
}
popupStack.push(id);
}

function closePopup() {
  

  const id = popupStack.pop();
  const popup = document.getElementById(id);
  if (popup) {
    popup.classList.remove('show');
    popup.classList.add('hidden');
    setTimeout(() => {
      popup.style.display = 'none';
      popup.classList.remove('hidden');
    }, 300);
  }

  // ÙÙ‚Ø· ÙˆÙ‚ØªÛŒ Ø§ÙˆÙ„ÛŒÙ† Ù¾Ø§Ù¾â€ŒØ¢Ù¾ Ø¨Ø³ØªÙ‡ Ù…ÛŒØ´Ù‡ØŒ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø±Ùˆ Ø¨Ø±Ú¯Ø±Ø¯
  if (popupStack.length === 0 && window.location.hash.includes('popup-')) {
    history.back();
  }

 
document.getElementById('popupOverlay').style.display = 'none';
}

window.onpopstate = function () {
  const popupIds = [ 'popupBrand', 'popupModel', 'popupTip', 'featuresPopup', 'descPopup' ];

  popupIds.forEach(id => {
    const popup = document.getElementById(id);
    if (popup && popup.style.display === 'block') {
      popup.classList.add('hidden');
      setTimeout(() => {
        popup.style.display = 'none';
        popup.classList.remove('hidden');
      }, 300);
    }
  });

  // Ø¨Ø³ØªÙ‡ Ø´Ø¯Ù† ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ùˆ Ø¬Ø²Ø¦ÛŒØ§Øª
  document.getElementById('historyPopup').style.display = 'none';
  document.getElementById('detailsPopup').style.display = 'none';

  popupStack.splice(0, popupStack.length);
  document.getElementById('popupOverlay').style.display = 'none';
};
  

document.addEventListener('keydown', e => {
  if (e.key === 'Escape') {
    closePopup();
    document.getElementById('historyPopup').style.display = 'none';
    document.getElementById('detailsPopup').style.display = 'none';
  }
});
// Ø­Ø°Ù Ú©Ù„Ø§Ø³ Ø®Ø·Ø§ Ù‡Ù†Ú¯Ø§Ù… ØªØ§ÛŒÙ¾ Ø¯Ø± ÙÛŒÙ„Ø¯Ù‡Ø§
window.addEventListener('DOMContentLoaded', () => {
  const fieldsToWatch = [
    'code', 'area', 'brandInput', 'price', 'year', 'km','gearbox',
    'color', 'motor', 'body', 'bimeh', 'features', 'desc'
  ];

  fieldsToWatch.forEach(id => {
    const el = document.getElementById(id);
    if (el) {
      el.addEventListener('input', () => el.classList.remove('error'));
    }
  });
});



  </script>
</body>
</html>


